{"version":3,"file":"cool-storage-base.js","sourceRoot":"","sources":["../../src/cool-storage-base.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable, Subject } from 'rxjs';\r\nimport { StorageChangeArguments } from './storage-change-arguments.interface';\r\n\r\nexport abstract class CoolStorageBase {\r\n  private _storageObject: any;\r\n  private _itemSetSubject: Subject<StorageChangeArguments>;\r\n  private _itemRemovedSubject: Subject<StorageChangeArguments>;\r\n\r\n  constructor(storageObject: any, storageObjectName: string) {\r\n    if (!storageObject) {\r\n      throw new Error(`Current browser does not support ${ storageObjectName }`);\r\n    }\r\n\r\n    this._storageObject = storageObject;\r\n\r\n    this._itemSetSubject = new Subject<StorageChangeArguments>();\r\n    this._itemRemovedSubject = new Subject<StorageChangeArguments>();\r\n  }\r\n\r\n  public get itemSetObservable(): Observable<StorageChangeArguments> {\r\n    return this._itemSetSubject.asObservable();\r\n  }\r\n\r\n  public get itemRemovedObservable(): Observable<StorageChangeArguments> {\r\n    return this._itemRemovedSubject.asObservable();\r\n  }\r\n\r\n  public getItem(key: string): string {\r\n    return this._storageObject.getItem(key) || null;\r\n  }\r\n\r\n  public setItem(key: string, value: string): void {\r\n    this._itemSetSubject.next({\r\n      key,\r\n      value\r\n    });\r\n\r\n    this._setItemInStorage(key, value);\r\n  }\r\n\r\n  public removeItem(key: string): void {\r\n    let currentValue = this.tryGetObject(key);\r\n\r\n    if (!currentValue) {\r\n      currentValue = this.getItem(key);\r\n    }\r\n\r\n    this._itemRemovedSubject.next({\r\n      key,\r\n      value: currentValue\r\n    });\r\n\r\n    this._storageObject.removeItem(key);\r\n  }\r\n\r\n  public key(index: number): string {\r\n    return this._storageObject.key(index);\r\n  }\r\n\r\n  public clear(): void {\r\n    this._storageObject.clear();\r\n  }\r\n\r\n  public get length(): number {\r\n    return this._storageObject.length;\r\n  }\r\n\r\n  public getObject<T>(key: string): T {\r\n    let jsonInStorage = this.getItem(key);\r\n\r\n    if (jsonInStorage === null) {\r\n      return null;\r\n    }\r\n\r\n    return JSON.parse(jsonInStorage) as T;\r\n  }\r\n\r\n  public tryGetObject<T>(key: string): T {\r\n    try {\r\n      return this.getObject<T>(key);\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  public setObject(key: string, value: any): void {\r\n    this._itemSetSubject.next({\r\n      key,\r\n      value\r\n    });\r\n\r\n    this._setItemInStorage(key, JSON.stringify(value));\r\n  }\r\n\r\n  private _setItemInStorage(key: string, value: string) {\r\n    this._storageObject.setItem(key, value);\r\n  }\r\n}"]}